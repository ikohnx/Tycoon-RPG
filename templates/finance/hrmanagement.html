{% extends "core/base.html" %}

{% block title %}HR Management - Business Tycoon RPG{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2 class="gold-text mb-0">
                        <i class="bi bi-people-fill"></i> HR Management
                    </h2>
                    <p class="text-muted mb-0">Build and manage your dream team</p>
                </div>
                <a href="{{ url_for('core.hub') }}" class="btn btn-outline-light">
                    <i class="bi bi-arrow-left"></i> Back to Hub
                </a>
            </div>
        </div>
    </div>

    {% with messages = get_flashed_messages() %}
    {% if messages %}
    <div class="alert alert-info alert-dismissible fade show" role="alert">
        {% for message in messages %}
        <div>{{ message }}</div>
        {% endfor %}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endif %}
    {% endwith %}

    <div class="row">
        <div class="col-lg-8">
            <div class="card mb-4">
                <div class="card-header">
                    <i class="bi bi-puzzle"></i> HR Challenges
                </div>
                <div class="card-body">
                    <div class="list-group">
                        {% for challenge in challenges %}
                        <a href="{{ url_for('finance.hr_challenge', challenge_id=challenge.challenge_id) }}" 
                           class="list-group-item list-group-item-action bg-dark text-light d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">{{ challenge.title }}</h6>
                                <small class="text-muted">{{ challenge.description[:80] }}...</small>
                            </div>
                            <div class="text-end">
                                <span class="badge bg-info mb-1">{{ challenge.challenge_type|title }}</span>
                                <div>
                                    <span class="badge bg-success">+{{ challenge.exp_reward }} EXP</span>
                                </div>
                            </div>
                        </a>
                        {% else %}
                        <div class="text-center text-muted py-3">
                            <i class="bi bi-lock"></i> No challenges available yet
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            {% if employees %}
            <div class="card mb-4">
                <div class="card-header">
                    <i class="bi bi-person-badge"></i> Your Team
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-dark table-hover">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Role</th>
                                    <th>Department</th>
                                    <th class="text-end">Salary</th>
                                    <th class="text-center">Performance</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for emp in employees %}
                                <tr>
                                    <td><strong>{{ emp.employee_name }}</strong></td>
                                    <td>{{ emp.role_name }}</td>
                                    <td><span class="badge bg-secondary">{{ emp.department }}</span></td>
                                    <td class="text-end">${{ "{:,.0f}".format(emp.salary) }}</td>
                                    <td class="text-center">
                                        <div class="progress" style="height: 8px;">
                                            <div class="progress-bar {% if emp.performance_score >= 80 %}bg-success{% elif emp.performance_score >= 60 %}bg-warning{% else %}bg-danger{% endif %}" 
                                                 style="width: {{ emp.performance_score }}%"></div>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% endif %}

            <div class="card mb-4">
                <div class="card-header">
                    <i class="bi bi-person-plus"></i> Hire New Employee
                </div>
                <div class="card-body">
                    <form action="{{ url_for('finance.hire_employee') }}" method="post">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Role</label>
                                <select name="role_id" class="form-select bg-dark text-light" required>
                                    {% for role in roles %}
                                    <option value="{{ role.role_id }}">{{ role.role_name }} ({{ role.department }})</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Employee Name</label>
                                <input type="text" name="employee_name" class="form-control bg-dark text-light" 
                                       required placeholder="Enter name">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Starting Salary</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" name="salary" class="form-control bg-dark text-light" 
                                           required placeholder="Annual salary">
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-game btn-game-emerald">
                            <i class="bi bi-person-plus-fill"></i> Hire Employee
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card mb-4">
                <div class="card-header">
                    <i class="bi bi-briefcase"></i> Available Roles
                </div>
                <div class="card-body small" style="max-height: 300px; overflow-y: auto;">
                    {% for role in roles %}
                    <div class="mb-3 p-2 bg-dark rounded">
                        <div class="d-flex justify-content-between">
                            <strong>{{ role.role_name }}</strong>
                            <span class="text-success">${{ "{:,}".format(role.base_salary|int) }}</span>
                        </div>
                        <small class="text-muted">{{ role.department }}</small>
                        <p class="text-muted mb-0 small">{{ role.responsibilities[:60] }}...</p>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div class="card">
                <div class="card-header bg-info bg-opacity-25">
                    <i class="bi bi-lightbulb"></i> HR Concepts
                </div>
                <div class="card-body small">
                    <div class="mb-3">
                        <strong class="text-warning">Hiring</strong>
                        <p class="text-muted mb-0">Balance experience vs potential. Consider culture fit and budget constraints.</p>
                    </div>
                    <div class="mb-3">
                        <strong class="text-success">Performance Reviews</strong>
                        <p class="text-muted mb-0">Regular feedback drives improvement. Be fair but honest in assessments.</p>
                    </div>
                    <div class="mb-3">
                        <strong class="text-info">Retention</strong>
                        <p class="text-muted mb-0">Total compensation includes salary, benefits, growth opportunities, and culture.</p>
                    </div>
                    <div>
                        <strong class="text-danger">Conflict Resolution</strong>
                        <p class="text-muted mb-0">Listen to all sides. Focus on solutions, not blame.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
