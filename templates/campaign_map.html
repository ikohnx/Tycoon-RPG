{% extends "base.html" %}

{% block title %}Campaign Map - Business Tycoon RPG{% endblock %}

{% block body_class %}world-{{ stats.world|lower }}{% endblock %}

{% block content %}
<div class="container-fluid fade-in">
    <div class="row mb-4">
        <div class="col-12 text-center">
            <h1 class="game-title display-4">
                <i class="bi bi-map-fill text-warning"></i>
                Campaign Map
            </h1>
            <p class="game-subtitle">Navigate your path through the business world</p>
        </div>
    </div>
    
    <div class="row mb-3">
        <div class="col-12 text-center">
            <a href="{{ url_for('hub') }}" class="btn game-btn game-btn-purple">
                <i class="bi bi-arrow-left"></i> Return to HQ
            </a>
            <a href="{{ url_for('boss_challenges') }}" class="btn game-btn game-btn-crimson ms-2">
                <i class="bi bi-skull"></i> Boss Challenges
            </a>
        </div>
    </div>
    
    {% for discipline, data in campaign.items() %}
    <div class="card mb-4" style="background: rgba(0,0,0,0.7); border: 2px solid rgba(255,215,0,0.3);">
        <div class="card-header d-flex justify-content-between align-items-center" style="background: rgba(255,215,0,0.1);">
            <h4 class="mb-0 gold-text">
                {% if discipline == 'Marketing' %}
                <i class="bi bi-megaphone-fill"></i>
                {% elif discipline == 'Finance' %}
                <i class="bi bi-currency-dollar"></i>
                {% elif discipline == 'Operations' %}
                <i class="bi bi-gear-fill"></i>
                {% elif discipline == 'Human Resources' %}
                <i class="bi bi-people-fill"></i>
                {% elif discipline == 'Legal' %}
                <i class="bi bi-briefcase-fill"></i>
                {% elif discipline == 'Strategy' %}
                <i class="bi bi-lightbulb-fill"></i>
                {% endif %}
                {{ discipline }}
            </h4>
            <div>
                <span class="badge bg-warning text-dark">
                    <i class="bi bi-star-fill"></i> {{ data.total_stars }}/{{ data.max_stars }}
                </span>
                <span class="badge bg-success ms-2">
                    {{ data.completed_count }}/{{ data.total_count }} Complete
                </span>
            </div>
        </div>
        <div class="card-body">
            <div class="campaign-path d-flex align-items-center justify-content-start overflow-auto pb-3" style="gap: 10px;">
                {% for node in data.nodes %}
                <div class="campaign-node text-center position-relative" style="min-width: 100px;">
                    {% if not loop.first %}
                    <div class="path-connector" style="position: absolute; left: -35px; top: 50%; width: 30px; height: 4px; 
                        background: {% if node.unlocked %}linear-gradient(90deg, #ffd700, #ffaa00){% else %}rgba(100,100,100,0.5){% endif %};
                        transform: translateY(-50%);"></div>
                    {% endif %}
                    
                    {% if node.completed %}
                    <a href="{{ url_for('play_scenario', scenario_id=node.scenario_id) }}" 
                       class="node-circle d-flex align-items-center justify-content-center mx-auto mb-2"
                       style="width: 60px; height: 60px; border-radius: 50%; 
                              background: linear-gradient(135deg, #50c878, #3d9d5d);
                              border: 3px solid #ffd700; box-shadow: 0 0 15px rgba(80,200,120,0.5);
                              text-decoration: none;">
                        <i class="bi bi-check-lg text-white" style="font-size: 1.5rem;"></i>
                    </a>
                    <div class="stars-display">
                        {% for i in range(3) %}
                        <i class="bi bi-star{% if i < node.stars %}-fill text-warning{% else %} text-secondary{% endif %}" style="font-size: 0.8rem;"></i>
                        {% endfor %}
                    </div>
                    {% elif node.current %}
                    <a href="{{ url_for('play_scenario', scenario_id=node.scenario_id) }}" 
                       class="node-circle d-flex align-items-center justify-content-center mx-auto mb-2 pulse-glow"
                       style="width: 60px; height: 60px; border-radius: 50%; 
                              background: linear-gradient(135deg, #ffd700, #ffaa00);
                              border: 3px solid #fff; box-shadow: 0 0 20px rgba(255,215,0,0.7);
                              text-decoration: none; animation: pulse-glow 1.5s infinite;">
                        <span class="text-dark fw-bold">{{ node.node_index }}</span>
                    </a>
                    <div class="text-warning small">PLAY</div>
                    {% elif node.unlocked %}
                    <a href="{{ url_for('play_scenario', scenario_id=node.scenario_id) }}" 
                       class="node-circle d-flex align-items-center justify-content-center mx-auto mb-2"
                       style="width: 60px; height: 60px; border-radius: 50%; 
                              background: linear-gradient(135deg, #4a90d9, #357abd);
                              border: 3px solid rgba(255,255,255,0.3); box-shadow: 0 0 10px rgba(74,144,217,0.3);
                              text-decoration: none;">
                        <span class="text-white fw-bold">{{ node.node_index }}</span>
                    </a>
                    <div class="text-info small">Ready</div>
                    {% else %}
                    <div class="node-circle d-flex align-items-center justify-content-center mx-auto mb-2"
                         style="width: 60px; height: 60px; border-radius: 50%; 
                                background: rgba(50,50,50,0.8);
                                border: 3px solid rgba(100,100,100,0.5);">
                        <i class="bi bi-lock-fill text-secondary"></i>
                    </div>
                    <div class="text-secondary small">Locked</div>
                    {% endif %}
                    
                    <div class="small text-muted mt-1" style="font-size: 0.7rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 90px;" title="{{ node.title }}">
                        L{{ node.level }}
                    </div>
                </div>
                {% endfor %}
                
                {% if data.nodes|length < 10 %}
                <div class="campaign-node text-center" style="min-width: 100px;">
                    <div class="path-connector" style="position: absolute; left: -35px; top: 50%; width: 30px; height: 4px; background: rgba(100,100,100,0.3);"></div>
                    <div class="node-circle d-flex align-items-center justify-content-center mx-auto mb-2"
                         style="width: 60px; height: 60px; border-radius: 50%; 
                                background: rgba(30,30,30,0.5); border: 3px dashed rgba(100,100,100,0.3);">
                        <i class="bi bi-three-dots text-secondary"></i>
                    </div>
                    <div class="text-secondary small">More Soon</div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<style>
.campaign-path::-webkit-scrollbar {
    height: 8px;
}
.campaign-path::-webkit-scrollbar-track {
    background: rgba(0,0,0,0.3);
    border-radius: 4px;
}
.campaign-path::-webkit-scrollbar-thumb {
    background: linear-gradient(90deg, #ffd700, #ffaa00);
    border-radius: 4px;
}
@keyframes pulse-glow {
    0%, 100% { box-shadow: 0 0 20px rgba(255,215,0,0.5); }
    50% { box-shadow: 0 0 35px rgba(255,215,0,0.9); }
}
.node-circle:hover {
    transform: scale(1.1);
    transition: transform 0.2s ease;
}
</style>
{% endblock %}
